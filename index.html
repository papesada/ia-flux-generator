<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PAPESADA FLUX - Générateur d'images</title>
<style>
.hidden{display:none;}
#output-image{max-width:100%;height:auto;border:1px solid #ddd;padding:8px;background:#fff;}
#loading{font-style:italic;}
</style>
</head>
<body>
<h1>PAPESADA FLUX</h1>
<label for="prompt">Description :</label>
<input id="prompt" type="text" placeholder="Entrez votre description">
<button id="btn-gen">Générer / Wo</button>
<span id="loading" class="hidden">Chargement...</span>

<div id="result" class="hidden">
<h2>Résultat</h2>
<img id="output-image" alt="Résultat image">
<p><a id="download-link" href="#" download="image.png">Télécharger</a></p>
</div>

<script>
const translations = {
  fr: { gen: "Générer"},
  wo: { gen: "Ñëw" }
};
let currentLang = 'fr';

async function genererImage() {
    const promptSaisi = document.getElementById('prompt').value;

    if (!promptSaisi) {
        alert("Veuillez saisir une description / Bindal li nga bëgg");
        return;
    }

    // Préparation de l'interface
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const btnGen = document.getElementById('btn-gen');

    loading.classList.remove('hidden');
    result.classList.add('hidden');
    btnGen.disabled = true;
    btnGen.innerText = "Chargement... / Mu ngiy ñëw...";

    const promptOptimise = `${promptSaisi}, clear educational illustration, professional pedagogical diagram, bright colors, white background, high resolution, 4k`;

    try {
        const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: promptOptimise }),
        });

        if (!response.ok) throw new Error("Erreur API");

        const blob = await response.blob();
        const url = URL.createObjectURL(blob);

        // Affichage du résultat
        const img = document.getElementById('output-image');
        img.src = url;
        document.getElementById('download-link').href = url;

        result.classList.remove('hidden');
    } catch (e) {
        alert("Njumte / Erreur : Impossible de contacter l'IA. Vérifiez votre connexion ou votre Token.");
        console.error(e);
    } finally {
        loading.classList.add('hidden');
        btnGen.disabled = false;
        btnGen.innerText = translations[currentLang].gen + " / " + translations['wo'].gen;
    }
}

document.getElementById('btn-gen').addEventListener('click', genererImage);
</script>
</body>
</html>
